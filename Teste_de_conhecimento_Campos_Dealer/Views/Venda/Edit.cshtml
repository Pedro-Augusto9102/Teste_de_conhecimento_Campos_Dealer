@using Teste_de_conhecimento_Campos_Dealer.Models
@using Teste_de_conhecimento_Campos_Dealer.Models.Entities
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@model dynamic


<form method="post">
    <div class="mt-3">
        @foreach (Venda venda in Model.venda)
        {
            <input type="hidden" class="form-control" value=@venda.Id name="Id" readonly />    
        }
        
        <select id="cliente" class="form-select" aria-label="Default select example" name="clienteId">
            @foreach(Venda venda in Model.venda)
            {
                <option value=@venda.cliente.Id selected>@venda.cliente.Name</option>
            }
            
            @foreach (Cliente cliente in Model.cliente)
            {
                <option value=@cliente.Id>@cliente.Name</option>
            }
        </select>
    </div>

    <div class="mt-3">
        <select id="produtos" onchange="atualizarValor()" class="mt-3 form-select" aria-label="Default select example" required name="produtoId">
            @foreach (Venda venda in Model.venda)
            {
                <option value=@venda.produto.Id selected>@venda.produto.dscProduto</option>
            }
            @foreach (Produto produto in Model.produto)
            {
                <option value=@produto.Id>@produto.dscProduto</option>
            }
        </select>
    </div>

    <div class="mt-3">
        <label class="form-label">Valor unitário</label>
        @foreach(Venda venda in Model.venda)
        {
            <input class="form-control" value=@venda.vlrUnitarioVenda id="valor_unitario" name="vlrUnitarioVenda" />
        }
        
    </div>

    <div class="mt-3">
        <label class="form-label">Quantidade </label>
        @foreach (Venda venda in Model.venda)
        {
            <input type="number" class="form-control" value=@venda.qtdVenda id="quantidade" onchange="valorTotal()" required name="qtdVenda" />   
        }
        
    </div>

    <div class="mt-3">
        <label class="form-label">Valor Total da Venda </label>
        @foreach (Venda venda in Model.venda)
        {
            <input  class="form-control" value=@venda.vlrTotalVenda id="total" name="vlrTotalVenda" />    
        }
        
    </div>


    <div class="mt-3">
        <button type="submit" class="btn btn-primary">Salvar</button>
        <button type="submit" class="btn btn-danger ms-3" asp-action="Delete" asp-controller="Venda">Deletar</button>
    </div>
</form>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function atualizarValor() {
            var selectBox = document.getElementById("produtos");
            var selectedValue = selectBox.options[selectBox.selectedIndex].value;
            // Faz uma requisição AJAX para buscar o valor do produto selecionado
            $.ajax({
                type: "GET",
                url: "/Produto/Search",
                dataType: "json",
                data: { id: selectedValue },
                success: function (res) {
                    console.log(res.value.vlrUnitário)
                    let elem = document.getElementById("valor_unitario")
                    elem.value = res.value.vlrUnitário
                },
                error: function (req, status, erro) {
                    console.log(erro)
                }
            });
        }
        function valorTotal() {
            let valorUni = document.getElementById("valor_unitario").value
            let qtd = document.getElementById("quantidade").value
            let elem = document.getElementById("total")
            elem.value = valorUni * qtd
        }
    </script>
}


